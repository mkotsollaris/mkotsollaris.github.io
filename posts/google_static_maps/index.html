<!DOCTYPE html>
<!--Author: Menelaos Kotsollaris
    Email: menelaos@mkotsollaris.com
    All rights reserved Â©-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="../../initializeComponents.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="http://http:www.mkotsollaris.com/pictures/ic_MK.jpeg">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="Menelaos Kotsollaris">
    <link rel="icon" href="../../pictures/ic_MK.jpeg">
    <title>Menelaos Kotsollaris</title>
    <!-- Bootstrap core CSS -->
    <link href="../../dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="../../css/blog.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <script src="../../js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../js/ie-emulation-modes-warning.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
    <![endif]-->
</head>
<body onload="topMenuLoad(-1)">
<div class="blog-masthead">
    <div class="container">
        <nav class="blog-nav" id="blogNavID">
        </nav>
    </div>
</div>

<div class="container">
    <br>

    <div class="row">
        <div class="col-sm-8 blog-main">
            <div class="blog-post">
                <h1 class="blog-post-title">Drawing circles in Google Static Maps API & GeoLocation Services - PHP & AJAX</h1>
                <br>
                <button type="button" onclick="getLocation()" class="btn btn-primary btn-lg">Run Code</button>
                <br>
                <br>
                <h4 id="northDistanceID"></h4>

                <h4 id="southDistanceID"></h4>

                <h4 id="currentLocationID"></h4>

                <div id="mapHolder"></div>
                <div id="circleDescriptionID"></div>
                <br>

                <div id="urlDescriptionID"></div>
                <div style="word-wrap: break-word; font-size: x-small;" id="urlID"></div>
                <br>
                <h1 class="blog-post-title">Drawing circles in Google Static Maps API</h1>
                You can represent a circle by a drawing a detailed PolyLine, since Google Static Maps does not support drawing a circle itself.
                Here is a request example that contains 2 circles with radius 0.5 and 5 kilometres. Keep in mind that you need an algorithm in order
                to generate proper encoding polylines. In this example we are sending an AJAX request to the server which contains the following code:
                <br>
                <br>
<pre><code>/* set some options */
$mapLat = filter_input(INPUT_POST, 'lat1'); // latitude for map's and circle's center
$mapLng = filter_input(INPUT_POST, 'lon1'); // longitude for map's and circle's center
$mapRadius1 = 0.5; // the radius of the first circle (in Kilometres)
$mapRadius2 = 5; // the radius of the second circle (in Kilometres)
$mapFill_first = '330000'; // fill colour of the first circle
$mapFill_second = 'FF99FF'; // fill colour of the second circle
$map1Border1 = '91A93A'; // border colour of the first circle
$map1Border2 = '0000CC'; // border colour of the second circle
$mapWidth = 450; // map image width (max 640px)
$mapHeight = 450; // map image height (max 640px)
$zoom = 11;
$scale = 2;
/** create our encoded polyline string for the first circle*/
$EncString1 = GMapCircle($mapLat, $mapLng, $mapRadius1);
/** create our encoded polyline string for the second circle*/
$EncString2 = GMapCircle($mapLat, $mapLng, $mapRadius2);
/** put together the static map URL */
$MapAPI = 'http://maps.google.com.au/maps/api/staticmap?';
$MapURL = $MapAPI . 'center=' . $mapLat . ',' . $mapLng . '&zoom=' . $zoom . '&size=' .
$mapWidth . 'x' . $mapHeight . '&scale=' . $scale . '&markers=color:red%7Clabel:S%7C'.$mapLat.','.$mapLng .
'&maptype=roadmap&path=fillcolor:0x' . $mapFill_first .
'33%7Ccolor:0x' . $map1Border1 . '00%7Cenc:' . $EncString1 . '&path=fillcolor:0x' .
$mapFill_second . '33%7Ccolor:0x' . $map1Border2 . '00%7Cenc:' . $EncString2;
echo json_encode($MapURL);
</code></pre>
                After this simply call the following <code>GMapCircle</code> function:
<pre><code>function GMapCircle($Lat, $Lng, $Rad, $Detail = 8)
{
    $R = 6371;
    $pi = pi();
    $Lat = ($Lat * $pi) / 180;
    $Lng = ($Lng * $pi) / 180;
    $d = $Rad / $R;
    $points = array();
    for ($i = 0; $i <= 360; $i += $Detail)
    {
        $brng = $i * $pi / 180;
        $pLat = asin(sin($Lat) * cos($d) + cos($Lat) * sin($d) * cos($brng));
        $pLng = (($Lng + atan2(sin($brng) * sin($d) * cos($Lat), cos($d) - sin($Lat) * sin($pLat))) * 180) / $pi;
        $pLat = ($pLat * 180) / $pi;
        $points[] = array($pLat, $pLng);
    }

    require_once('PolylineEncoder.php');
    $PolyEnc = new PolylineEncoder($points);
    $EncString = $PolyEnc->dpEncode();

    return $EncString['Points'];
}
</code></pre>
                As for the second part, on how to get the location, you just need to use the
                <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/getCurrentPosition">Geolocation.getCurrentPosition</a>
                method, as it's being shown from the following <code>getLocation</code> function:
<pre><code>function getLocation()
{
    if(navigator.geolocation)
    {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    }
    else
    {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}
</code></pre>
            </div>
            <br>
            <div id="disqus_thread"></div>
            <script>
                /**
                 * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                 * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                 */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
                (function ()
                { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');

                    s.src = '//wwwmkotsollariscom.disqus.com/embed.js';

                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                })();
            </script>
        </div>
        <div id="sideBarMenuID" class="col-sm-3 col-sm-offset-1 blog-sidebar" align="center"></div><!-- /.blog-sidebar -->
    </div><!-- /.row -->
</div><!-- /.container -->
<footer class="blog-footer" id="footerID"></footer>
<script>
    var x = document.getElementById("northDistanceID");

    function getLocation()
    {
        if(navigator.geolocation)
        {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        }
        else
        {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position)
    {
        $.post(
                'ServerComputations.php',
                {
                    lat1: position.coords.latitude, lon1: position.coords.longitude
                },
                function (data)
                {
                    //alert(JSON.parse(data));
                    var img_url = JSON.parse(data);
                    document.getElementById("mapHolder").innerHTML = "<img src='" + img_url + "'>";
                    document.getElementById("urlID").innerHTML = "URL: "+img_url;
                });

        $.post(
                'calculateWMSOperations.php',
                {
                    lat1: position.coords.latitude, lon1: position.coords.longitude
                },
                function (data)
                {
                    var northDistance = '';
                    var southDistance = '';
                    var currString = 1;
                    //alert(JSON.parse(data));
                    var myData = JSON.parse(data);
                    for (var i = 0; i < myData.length; i++)
                    {
                        if(myData.charAt(i) != ',')
                        {
                            if(currString === 1)
                            {
                                northDistance += myData.charAt(i);
                            }
                            else if(currString === 2)
                            {
                                southDistance += myData.charAt(i);
                            }
                        }
                        else
                        {
                            currString = 2;
                        }
                    }
                    document.getElementById("northDistanceID").innerHTML =
                            "1. Your spherical Distance from North Pole: " + northDistance + " kilometres";
                    document.getElementById("southDistanceID").innerHTML =
                            "2. Your spherical Distance from South Pole: " + southDistance + " kilometres";
                    document.getElementById("currentLocationID").innerHTML = "3. You current Location (Lat,Lon): " +
                            position.coords.latitude + ", " + position.coords.longitude;
                });
    }

    function showError(error)
    {
        switch (error.code)
        {
        case error.PERMISSION_DENIED:
            x.innerHTML = "User denied the request for Geolocation.";
            break;
        case error.POSITION_UNAVAILABLE:
            x.innerHTML = "Location information is unavailable.";
            break;
        case error.TIMEOUT:
            x.innerHTML = "The request to get user location timed out.";
            break;
        case error.UNKNOWN_ERROR:
            x.innerHTML = "An unknown error occurred.";
            break;
        }
    }
</script>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="../../dist/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../../js/ie10-viewport-bug-workaround.js"></script>
</body>
</html>
