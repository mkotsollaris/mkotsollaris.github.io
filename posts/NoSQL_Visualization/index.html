<!DOCTYPE html>
<!--Author: Menelaos Kotsollaris
    Email: menelaos@mkotsollaris.com
    All rights reserved ©-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="../../initializeComponents.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../pictures/ic_MK.jpeg">
    <title>Menelaos Kotsollaris</title>
    <!-- Bootstrap core CSS -->
    <link href="../../dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="../../css/blog.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <script src="../../js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../js/ie-emulation-modes-warning.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
    <![endif]-->
</head>
<body onload="topMenuLoad(-1)">
<div class="blog-masthead">
    <div class="container">
        <nav class="blog-nav" id="blogNavID">
        </nav>
    </div>
</div>

<div class="container">
    <br>
    <div class="row">
        <div class="col-sm-8 blog-main">
            <div class="blog-post">
                <h1 class="blog-post-title">Data Visualization in MongoDB - NOSQL</h1>
                <br>
                <br>
                After much research, I found a way of actually querying specific objects and visualizing them using RoboMongo and Google Drag and Drop
                GeoJSON.

                For the query part we can use the below technique as specified here:
<pre><code>//[Thematic] Finds all the LineString documents that contain “Avenue” in their name.
db.LineString.aggregate(
{ $match : {
"features.properties.name": /avenue/i
}},
{ $unwind : "$features" },
{ $match : {
"features.properties.name": /avenue/i
}}
)
</code></pre>
                Here we use the $unwind aggregation stage in order to define what field we want to retrieve. After that we use $match in order
                retrieve the documents with the specific conditions. Note that the first match can take advantage of an index (Text, Spatial etc..)
                and fasten the time by a lot. By right clicking on the document in MongoDB we can view+store the generated JSON.

                However, when working with Spatial data you will probably like to have your data in the map, especially when working with complex
                structures. In order to do so, you will need to convert your data from JSON to GeoJSON. Below I will show the regular expression I
                used in order to convert my file.

                Algorithm JSON file (generated from MongoDB) to GeoJSON:

                Erase: <pre><code>"features" : \{.* <b>AND</b> "coordinates"[^}]*\K\} AND "type" : "Feature" <b>AND</b> "ok" : 1.0000000000000000
                <b>AND</b> "id".*,
                <b>AND</b>"_id" :
                ObjectId(.*`<br>
                <b>Replace with:</b> "type" : "FeatureCollection",[^}]*\}, <b>WITH</b> "type" : "Feature", <b>AND</b> "result" : [ <b>WITH</b>
                "features" : [
                {
                "type": "FeatureCollection",
                "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                "features" : [</code></pre>
                I run these regular expressions using Notepad++:

                <pre><code>"features" : \{.*|"coordinates"[^}]*\K\}|"type" : "Feature"|"ok" : 1.0000000000000000|"id".*,|"_id" : ObjectId\(.*,
                    "type" : "FeatureCollection",[^}]*\}, replace with "type" : "Feature",</code></pre>
                <blockquote>Disclaimer: Please notice that your file might follow a different structure, since the way you project the data
                    obviously effects the
                    output file. In such a case, extra modification is required.
                </blockquote>
                Now that we have the GeoJSON file we can drag and drop it to Google's GeoJSON API. The above query will give us the roads of Vancouver
                that contain "Avenue" on their names:<br><br>

                <img src="../../pictures/ic_Vancouver.png">
                <br><br>

                Thoughts: I believe that this job could be done directly from RoboMongo since the produced JSON can be converted to GeoJSON with some
                inferior changes. Also please note that this REGEX is way too complicated and if you are interested in a more stable solution I would
                suggest you to use a JSON Library like NodeJS, Jackson etc and generate a brand new file.I came up with this solution and it worked
                perfectly for my case.
            </div>
            <br>
            <div id="disqus_thread"></div>
            <script>
                /**
                 * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                 * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                 */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
                (function ()
                { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');

                    s.src = '//wwwmkotsollariscom.disqus.com/embed.js';

                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                })();
            </script>
        </div>
        <div id="sideBarMenuID" class="col-sm-3 col-sm-offset-1 blog-sidebar" align="center"></div><!-- /.blog-sidebar -->
    </div><!-- /.row -->
</div><!-- /.container -->

<footer class="blog-footer" id="footerID"></footer>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="../../dist/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../../js/ie10-viewport-bug-workaround.js"></script>
</body>
</html>
